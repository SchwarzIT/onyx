@use "breakpoints.scss" as *;

// prettier-ignore
$gridVariants: (
//  NAME    MAX-VARIANT  COLUMNS  GUTTER  MARGIN
    "2xs"   none         4        1rem    1rem,
    "xs"    none         8        1rem    1rem,
    "sm"    none         8        1.5rem  2rem,
    "md"    none         12       1.5rem  4rem,
    "lg"    "md"         16       2rem    4rem,
    "xl"    "lg"         16       2rem    4rem,
);

// offset 1 is used so the styles only apply to "greater than breakpoint"
// so it does not jump around when the browser windows is resized by a few pixels
$screenOffset: 1;

@layer onyx.utility {
  /**
  * Grid container base class
  */
  .onyx-grid {
    display: grid;
    grid-template-columns: repeat(var(--onyx-grid-columns), minmax(0, 1fr));
    gap: var(--onyx-grid-gutter);
  }

  /**
  * Page class to apply padding, max-width and optional centered.
  * Is usually placed at the root element of every page.
  */
  .onyx-grid-container {
    // Note: The --onyx-grid-margin is implemented as padding here so that is also included in e.g. custom background colors
    // but the term "margin" comes from UX/Figma so we decided to keep naming it margin to be aligned
    padding: var(--onyx-grid-margin);
    max-width: var(--onyx-grid-max-width, none);
    margin-inline: var(--onyx-grid-margin-inline);
    box-sizing: border-box; // max-width should include the padding
  }

  /**
  * Utility class to allow optional centering for pages with max width.
  * Requires a "onyx-grid-max-*" class to be set.
  */
  .onyx-grid-center {
    --onyx-grid-margin-inline: auto;
  }

  /**
  * Grid container class for "xl" breakpoint variant with 20 columns
  */
  @include screen(min, xl, $screenOffset) {
    .onyx-grid-xl-20 {
      --onyx-grid-columns: 20;
    }
  }

  /**
  * Grid element class for defining how many columns the element spans
  */
  @for $i from 1 through 20 {
    .onyx-grid-span-#{$i} {
      grid-column-end: span min($i, var(--onyx-grid-columns));
    }
  }

  @mixin generateGridProperties($columns, $gutter, $margin) {
    :where(:root) {
      --onyx-grid-columns: #{$columns};
      --onyx-grid-gutter: #{$gutter};
      --onyx-grid-margin: #{$margin};
    }
  }

  /**
  * Grid element class for defining breakpoint specific column count
  */
  @mixin generateSpans($first, $last, $name) {
    @for $span from $first through $last {
      .onyx-grid-#{$name}-span-#{$span} {
        grid-column-end: span min($span, var(--onyx-grid-columns));
      }
    }
  }

  /**
  * Grid container class for defining breakpoint specific max width
  */
  @mixin generateGridMax($name, $maxVariant, $margin) {
    .onyx-grid-max-#{$maxVariant} {
      --onyx-grid-max-width: #{map-get($breakpoints, $name)};
    }
  }

  @each $name, $maxVariant, $columns, $gutter, $margin in $gridVariants {
    @if $name == "2xs" {
      @include generateGridProperties($columns, $gutter, $margin);
      @include generateSpans(1, $columns, $name);
    } @else {
      @include screen(min, $name, $screenOffset) {
        @include generateGridProperties($columns, $gutter, $margin);
        @include generateSpans(1, $columns, $name);

        @if $maxVariant != none {
          @include generateGridMax($name, $maxVariant, $margin);
        }

        @if $name == "xl" {
          @include generateSpans(17, 20, $name);
        }
      }
    }
  }
}
